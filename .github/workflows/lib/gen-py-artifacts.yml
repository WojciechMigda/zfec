#
# Generate artifacts required by python-centric workflows
#

name: gen-python-artifacts

on:
  workflow_call:

jobs:
  generate_enum_pxi:
    runs-on: "ubuntu-latest"
    steps:
      - name: "Check out zfex sources"
        uses: actions/checkout@v3

      - name: "Generate PXIs"
        run: |
          printf "# Generated by gen-py-artifacts.yml\n# Edit the yml file instead!\n\ncdef extern from \"zfex_status.h\":\n    ctypedef enum zfex_status_code_t:\n$(grep 'ZFEX_SC_' zfex/zfex_status.h | sed 's/ZFEX_SC_/        ZFEX_SC_/g')\n" > zfex/_zfex_status.pxi
          if [[ $(git diff --stat zfex/_zfex_status.pxi) != '' ]] \
          || [[ $(git status --untracked --short zfex/_zfex_status.pxi) != '' ]]; then
            echo "::set-output name=dirty-pxi::true"
          fi
